// ============================================================
// 文件名：main.cpp
// 功能：程序入口
// 说明：Qt 应用程序的入口点，创建并显示主窗口
// ============================================================

// ============================================================
// Qt 头文件
// ============================================================
#include <QApplication>     // Qt 应用程序类
#include <QDebug>          // 调试输出
#include <QTimer>          // 定时器

// ============================================================
// 项目头文件
// ============================================================
#include "mainwindow.h"
#include "version.h"

/**
 * @brief main - 程序入口函数
 *
 * 这是 C++ 程序的入口点。对于 Qt GUI 程序，主要做以下事情：
 * 1. 创建 QApplication 对象 - 管理 GUI 程序的控制流和主要设置
 * 2. 创建并显示主窗口
 * 3. 进入事件循环 - 处理用户输入和系统事件
 *
 * 学习要点：
 * 1. QApplication vs QCoreApplication
 *    - QApplication: GUI 程序使用，包含图形界面支持
 *    - QCoreApplication: 控制台程序使用，无图形界面
 *
 * 2. 事件循环 (Event Loop)
 *    - Qt 程序通过事件循环响应用户操作
 *    - a.exec() 启动事件循环，直到程序退出
 *
 * @param argc 命令行参数个数
 * @param argv 命令行参数数组
 * @return 程序退出码，0 表示正常退出
 */
int main(int argc, char *argv[])
{
    // ========================================
    // 步骤1：创建 QApplication 对象
    // ========================================
    // QApplication 必须在任何 Qt 窗口对象之前创建
    // 它初始化 Qt 的图形系统和事件处理机制
    QApplication a(argc, argv);

    // 设置应用程序信息（用于 QSettings 等）
    QApplication::setOrganizationName("NikkeQt");
    QApplication::setApplicationName("MouseMacro");
    QApplication::setApplicationVersion(APP_VERSION);

    // 输出启动信息
    qDebug() << "========================================";
    qDebug() << "Nikke Qt 鼠标宏 v" << APP_VERSION;
    qDebug() << "========================================";
    qDebug() << "提示: 需要管理员权限才能在游戏中使用";
    qDebug() << "========================================";

    // ========================================
    // 步骤2：创建并显示主窗口
    // ========================================
    // MainWindow 对象在栈上创建，当 main() 函数结束时自动销毁
    MainWindow w;
    w.show();  // 显示窗口

    // ========================================
    // 步骤3：启动时自动检查更新
    // ========================================
    // 使用 QTimer::singleShot 延迟检查，避免阻塞启动
    QTimer::singleShot(2000, &w, &MainWindow::checkForUpdates);

    // ========================================
    // 步骤4：进入事件循环
    // ========================================
    // a.exec() 启动 Qt 的事件循环
    // 程序会在这里等待，直到所有窗口关闭或调用 quit()
    // 返回值是程序的退出码
    return a.exec();
}
